<%#
# (c) Copyright Ascensio System SIA 2022
# http://www.onlyoffice.com
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
%>

<%= render :parent %>
<% if OnlyofficeController.checking_activity_onlyoffice %>

    <% if User.current.allowed_to?(:add_documents, @project) %>

    <% content_for :header_tags do %>
        <%= stylesheet_link_tag 'onlyoffice-icons', plugin: 'onlyoffice_redmine' %>
    <% end %>

    <span id="onlyoffice-create-dropdown" class="drdn hidden">
        <span class="drdn-trigger">
            <span><%= l(:onlyoffice_create_dropdown) %> <span class="icon-only icon-actions" title="<%= l(:onlyoffice_create_dropdown)%>"><%= l(:onlyoffice_create_dropdown)%></span></span>
        </span>
        <div class="drdn-content">
            <div class="drdn-items">
              <% FileUtility.format_manager.creatable.each do |format| %>
                <%= link_to l("onlyoffice_create_#{format.name}"), onlyoffice_create_new_path(format.name, @project), :class => "icon onlyoffice-create #{format.name}" %>
              <% end %>
            </div>
        </div>
    </span>

    <%= javascript_include_tag "onlyofficeMenu", :plugin => "onlyoffice_redmine" %>
    <script type="text/javascript" language="javascript">
        ONLYOFFICE.Buttons.addOnlyOfficeCreateButton(document.getElementsByClassName("contextual")[0]);
    </script>

    <% end %>
<% end %>